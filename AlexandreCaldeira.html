
    <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lanche de Natal</title>
<style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .box { margin-top: 20px; padding: 15px; border: 1px solid #aaa; width: 350px; }
    .hidden { display: none; }
    input, select { width: 95%; padding: 8px; margin-top: 5px; margin-bottom: 15px; }
    button { padding: 10px 20px; cursor: pointer; margin-top: 5px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
  const SUPABASE_URL = 'https://bijndfsxrzjviwrdvwms.supabase.co';
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpam5kZnN4cnpqdml3cmR2d21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NTA5NTIsImV4cCI6MjA2NjQyNjk1Mn0.EWaFInuqTaxvnjytb40DdnflEbBrbSYcViKLYc_kKBk";
  const supabase = supabase.createClient(SUPABASE_URL, supabaseKey);
</script>
</head>
<body>

<h2>üéÑ Lanche de Natal</h2>
<p>Escolha uma op√ß√£o:</p>

<label>
    <input type="radio" name="opcao" value="inscricao" onclick="mostrarOpcao()"> Efetuar inscri√ß√£o
</label><br>

<label>
    <input type="radio" name="opcao" value="negar" onclick="mostrarOpcao()"> Negar convite
</label>

<div id="formInscricao" class="box hidden">
    <h3>Inscri√ß√£o</h3>
    <label>Coordena√ß√£o</label><br>
    <select id="coordenacao">
        <option value="">Selecione</option>
        <option value="Coordena√ß√£o 1">Coordena√ß√£o 1</option>
        <option value="Coordena√ß√£o 2">Coordena√ß√£o 2</option>
    </select>

    <label>Nome completo</label><br>
    <input type="text" id="nome"><br>

    <label>E-mail</label><br>
    <input type="email" id="email"><br>

    <button onclick="gerarInscricao()">Gerar imagem</button>
    <p id="msgInscricao"></p>
</div>

<div id="formNegar" class="box hidden">
    <h3>Negar convite</h3>
    <label>Nome completo</label><br>
    <input type="text" id="nomeNegar"><br>

    <label>E-mail</label><br>
    <input type="email" id="emailNegar"><br>

    <button onclick="gerarNegativa()">Gerar imagem</button>
    <p id="msgNegar" style="font-weight:bold;"></p>
</div>

<script>
function mostrarOpcao() {
    const opcao = document.querySelector('input[name="opcao"]:checked').value;
    document.getElementById("formInscricao").classList.add("hidden");
    document.getElementById("formNegar").classList.add("hidden");
    if (opcao === "inscricao") document.getElementById("formInscricao").classList.remove("hidden");
    else document.getElementById("formNegar").classList.remove("hidden");
}

// ----------------------------
// INSCRI√á√ÉO
// ----------------------------
async function gerarInscricao() {
    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const coord = document.getElementById("coordenacao").value;

    if (!nome || !email || !coord) {
        alert("Preencha todos os campos.");
        return;
    }

    const mapaSites = { "a@a": "Site 1", "t@t": "Site 2" };
    const site = mapaSites[email.toLowerCase()] || "Site desconhecido";

    const mensagem = `Inscri√ß√£o realizada com sucesso!\nNome: ${nome}\nCoordena√ß√£o: ${coord}\nE-mail: ${email}\nSite: ${site}`;
    document.getElementById("msgInscricao").innerText = mensagem;

    // Salvar no Supabase
    try {
        const { data, error } = await supabase
            .from('participantes')
            .insert([{ nome, email, coordenacao: coord, site, codigo_negativa: null }]);

        if(error) throw error;
        console.log("Inscri√ß√£o salva:", data);
    } catch (err) {
        console.error("Erro ao salvar inscri√ß√£o:", err);
        alert("Erro ao salvar no banco.");
    }

    gerarImagem(mensagem, "inscricao.png");
}

// ----------------------------
// NEGATIVA
// ----------------------------
async function gerarNegativa() {
    const nome = document.getElementById("nomeNegar").value.trim();
    const email = document.getElementById("emailNegar").value.trim();

    if (!nome || !email) {
        alert("Preencha todos os campos.");
        return;
    }

    const codigo = "NEG-" + Math.random().toString(36).substring(2, 8).toUpperCase();
    const mensagem = `Negativa registrada!\nNome: ${nome}\nE-mail: ${email}\nC√≥digo: ${codigo}`;
    document.getElementById("msgNegar").innerText = mensagem;

    // Salvar no Supabase
    try {
        const { data, error } = await supabase
            .from('participantes')
            .insert([{ nome, email, coordenacao: null, site: null, codigo_negativa: codigo }]);

        if(error) throw error;
        console.log("Negativa salva:", data);
    } catch (err) {
        console.error("Erro ao salvar negativa:", err);
        alert("Erro ao salvar no banco.");
    }

    gerarImagem(mensagem, "negativa.png");
}

// ----------------------------
// GERAR IMAGEM
// ----------------------------
function gerarImagem(texto, nomeArquivo) {
    const canvas = document.createElement("canvas");
    canvas.width = 800;
    canvas.height = 400;
    const ctx = canvas.getContext("2d");

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#000000";
    ctx.font = "24px Arial";
    ctx.textAlign = "center";

    const linhas = texto.split("\n");
    linhas.forEach((linha, i) => {
        ctx.fillText(linha, canvas.width/2, 100 + i*40);
    });

    // Download da imagem
    const link = document.createElement("a");
    link.download = nomeArquivo;
    link.href = canvas.toDataURL("image/png");
    link.click();
}
</script>

</body>
</html>
